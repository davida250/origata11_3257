<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Prism Fold — Voronoi Retessellation</title>
    <meta name="description" content="Voronoi-driven folds, thin-film iridescence, and post-processed ghosting using Three.js." />
    <style>
      :root {
        --panel-w: 320px;
        --bg: #000;
        --fg: #e8e8e8;
        --muted: #a0a0a0;
        --accent: #59ffa7;
      }
      html, body {
        height: 100%; margin: 0; background: var(--bg); color: var(--fg);
        font: 14px/1.35 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
        overflow: hidden;
      }
      #app { position: fixed; inset: 0; }
      .panel {
        position: fixed; top: 0; right: 0; width: var(--panel-w); height: 100%;
        box-sizing: border-box; padding: 14px;
        background: radial-gradient(1200px 400px at 10% -10%, rgba(90,255,167,.05), transparent 60%), rgba(8,8,8,.72);
        backdrop-filter: blur(6px); border-left: 1px solid rgba(255,255,255,.08); overflow: auto; user-select: none;
      }
      .panel h1 { margin: 6px 0 10px; font-size: 16px; font-weight: 600; letter-spacing: .2px; }
      .panel small { color: var(--muted); }
      .group { margin: 10px 0 14px; padding: 10px; border: 1px solid rgba(255,255,255,.08); border-radius: 8px; background: rgba(255,255,255,.02); }
      .group h2 { margin: 0 0 8px; font-size: 12px; font-weight: 600; color: var(--muted); letter-spacing: .4px; text-transform: uppercase; }
      .row { display: grid; grid-template-columns: 1fr 100px; grid-gap: 10px; align-items: center; margin: 8px 0; }
      .row label { display: block; font-size: 13px; }
      .row .value { text-align: right; color: var(--muted); font-variant-numeric: tabular-nums; }
      input[type="range"] { width: 100%; margin: 0; -webkit-appearance: none; background: transparent; }
      input[type="range"]::-webkit-slider-runnable-track { height: 6px; background: linear-gradient(90deg, rgba(255,255,255,.2), rgba(255,255,255,.08)); border-radius: 999px; }
      input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 14px; height: 14px; margin-top: -4px; background: var(--fg); border-radius: 50%; border: 0; box-shadow: 0 0 0 2px #000 inset; }
      input[type="checkbox"] { transform: translateY(2px); accent-color: var(--accent); }
      .row-2col { display: grid; grid-template-columns: 1fr 1fr; grid-gap: 10px; }
      .btns { display: flex; gap: 8px; margin-top: 8px; flex-wrap: wrap; }
      button {
        padding: 8px 10px; border: 1px solid rgba(255,255,255,.15); background: rgba(255,255,255,.06);
        color: var(--fg); font-weight: 600; border-radius: 6px; cursor: pointer;
      }
      button:hover { background: rgba(255,255,255,.12); }
      .hint { position: fixed; left: 12px; bottom: 12px; color: var(--muted); background: rgba(0,0,0,.35); padding: 6px 8px; border-radius: 6px; }
      @media (max-width: 820px) { .panel { width: 82vw; } }
    </style>
  </head>
  <body>
    <div id="app" aria-label="Three.js canvas surface"></div>

    <aside class="panel" aria-label="Controls">
      <h1>Prism Fold <small>• voronoi remesh + ghosting</small></h1>

      <div class="group">
        <h2>Interaction</h2>
        <div class="row"><label><input id="followMouse" type="checkbox" checked /> Follow mouse fold</label><div class="value" id="followMouseVal"></div></div>
        <div class="row"><label><input id="autoSpin" type="checkbox" checked /> Auto spin</label><div class="value" id="autoSpinVal"></div></div>
        <div class="row"><label>Spin speed</label><div class="value"><span id="spinSpeedVal">0.0020</span></div></div>
        <input id="spinSpeed" type="range" min="0" max="0.01" step="0.0001" value="0.002" />
      </div>

      <div class="group">
        <h2>Structure (Voronoi)</h2>
        <div class="row"><label>Seed count</label><div class="value"><span id="seedCountVal">10</span></div></div>
        <input id="seedCount" type="range" min="3" max="16" step="1" value="10" />
        <div class="row"><label>Voronoi fold</label><div class="value"><span id="vFoldVal">0.65</span></div></div>
        <input id="vFold" type="range" min="0" max="1.6" step="0.01" value="0.65" />
        <div class="row"><label>Edge width</label><div class="value"><span id="edgeWidthVal">0.18</span></div></div>
        <input id="edgeWidth" type="range" min="0.02" max="0.5" step="0.01" value="0.18" />
        <div class="row"><label>Edge gain</label><div class="value"><span id="edgeGainVal">1.40</span></div></div>
        <input id="edgeGain" type="range" min="0" max="3" step="0.01" value="1.4" />
        <div class="btns">
          <button id="reseed">Reseed</button>
          <button id="regularize">Regularize</button>
        </div>
      </div>

      <div class="group">
        <h2>Bands & Film</h2>
        <div class="row"><label>Stripe frequency</label><div class="value"><span id="stripeFreqVal">11.0</span></div></div>
        <input id="stripeFreq" type="range" min="2" max="24" step="0.1" value="11" />
        <div class="row"><label>Stripe speed</label><div class="value"><span id="stripeSpeedVal">1.25</span></div></div>
        <input id="stripeSpeed" type="range" min="0" max="4" step="0.01" value="1.25" />
        <div class="row"><label>Film thickness (nm)</label><div class="value"><span id="thicknessVal">420</span></div></div>
        <input id="thickness" type="range" min="250" max="650" step="1" value="420" />
        <div class="row"><label>Film IOR</label><div class="value"><span id="iorVal">1.38</span></div></div>
        <input id="ior" type="range" min="1.25" max="1.55" step="0.001" value="1.38" />
      </div>

      <div class="group">
        <h2>Ghosting & FX</h2>
        <div class="row"><label>Afterimage damp</label><div class="value"><span id="afterVal">0.82</span></div></div>
        <input id="after" type="range" min="0" max="0.995" step="0.001" value="0.82" />
        <div class="row"><label>RGB shift</label><div class="value"><span id="rgbAmountVal">0.0020</span></div></div>
        <input id="rgbAmount" type="range" min="0" max="0.01" step="0.0001" value="0.0020" />
        <div class="row-2col">
          <div>
            <div class="row"><label>Bloom strength</label><div class="value"><span id="bloomStrengthVal">1.10</span></div></div>
            <input id="bloomStrength" type="range" min="0" max="2" step="0.01" value="1.10" />
          </div>
          <div>
            <div class="row"><label>Bloom radius</label><div class="value"><span id="bloomRadiusVal">0.55</span></div></div>
            <input id="bloomRadius" type="range" min="0" max="2" step="0.01" value="0.55" />
          </div>
        </div>
        <div class="row"><label>Bloom threshold</label><div class="value"><span id="bloomThresholdVal">0.15</span></div></div>
        <input id="bloomThreshold" type="range" min="0" max="1" step="0.001" value="0.15" />
        <div class="btns">
          <button id="reset">Reset</button>
          <button id="toggleBloom">Toggle Bloom</button>
        </div>
      </div>
    </aside>

    <div class="hint">Drag to orbit • Voronoi folds emulate retessellation • Ghosting = Afterimage</div>

    <!-- Import map + polyfill so 'three' and add-ons resolve in the browser -->
    <script async src="https://unpkg.com/es-module-shims@1.10.0/dist/es-module-shims.min.js"></script>
    <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
          "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
      }
    </script>

    <script type="module" src="./main.js"></script>
  </body>
</html>
